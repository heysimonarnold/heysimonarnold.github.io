---
import { SITE } from "@/configs/site";
const isProd = import.meta.env.PROD;
const gaKey = SITE.googleAnalyticsKey;
---

{isProd && (
  <>
    {/* Load GA script */}
    <script async src={`https://www.googletagmanager.com/gtag/js?id=${gaKey}`}></script>

    {/* Initialize GA */}
    <script is:inline data-key={gaKey}>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', document.currentScript.dataset.key);
    </script>

    {/* Track SPA route changes */}
    <script is:inline>
      document.addEventListener('astro:page-load', () => {
        if (typeof gtag === 'function') {
          gtag('event', 'page_view', { page_path: window.location.pathname });
        }
      });
    </script>
  </>
)}
